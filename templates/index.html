<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" type="text/css" href="../static/ext/resources/css/ext-all.css" />
	<link rel="stylesheet" type="text/css" href="../static/jquery-ui/theme/jquery-ui.css" />
	<script type="text/javascript" src="../static/jquery-1.7.1.min.js"></script>
	<script type="text/javascript" src="../static/jquery-ui/jquery-ui-1.10.3.custom.js"></script>
	<script type="text/javascript" src="../static/ext/adapter/jquery/ext-jquery-adapter.js"></script>
	<script type="text/javascript" src="../static/ext/adapter/ext/ext-base.js"></script>
	<script type="text/javascript" src="../static/ext/ext-all.js"></script>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/style.css">
    <title>Hello, world!</title>
  </head>
  <body>
  <p id="log"></p>
  <div class="container-pr">

    <div class="title">Quản lý cầu thủ</div>
    <div class="container">
      <div class="row">
        <div class="col-sm-1"></div>
        <div class="col-sm-10">
            <div id="table"></div>
            <br/><br/>
             <div id="table1"></div>
              <br/><br/>
             <div id="hachi"></div>
        </div>
        <div class="col-sm-1">
        </div>
      </div>
    </div>
     <form action="/add" method="POST">
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Thêm Cầu Thủ</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <form>
                  <div class="form-group">
                    <label class="col-form-label">Tên:</label>
                    <input type="text" class="form-control" id="name" name="name" required minlength="2" maxlength="20">
                  </div>
                  <div class="form-group">
                     <label class="col-form-label">Tuổi:</label>
                     <input type="number" class="form-control" id="age" name="age" required min="1" max="100">
                  </div>
                  <div class="form-group">
                     <label class="col-form-label">Quốc tịch:</label>
                     <input type="text" class="form-control" id="national" name="national" required minlength="2" maxlength="20">
                  </div>
                  <div class="form-group">
                     <label class="col-form-label">Vị trí:</label>
                     <input type="text" class="form-control" id="position" name="position" required minlength="2" maxlength="20">
                  </div>
                  <div class="form-group">
                     <label class="col-form-label">Lương:</label>
                     <input type="number" class="form-control" id="salary" name="salary" required min="1" max="100">
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                <button type="submit" class="btn btn-primary" id="btn-add" >Thêm</button>
              </div>
            </div>
          </div>
        </div>
        </form>

       <form action="" method="">
        <div class="modal fade" id="exampleModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel1">Edit Cầu Thủ</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <form>
                  <div class="form-group">
                    <input type="hidden" class="form-control" id="Id1" name="Id"  required minlength="2" maxlength="20">
                  </div>
                  <div class="form-group">
                    <label class="col-form-label">Tên:</label>
                    <input type="text" class="form-control" id="name1" name="name"  required minlength="2" maxlength="20">
                  </div>
                  <div class="form-group">
                     <label class="col-form-label">Tuổi:</label>
                     <input type="number" class="form-control" id="age1" name="age" required min="1" max="100">
                  </div>
                  <div class="form-group">
                     <label class="col-form-label">Quốc tịch:</label>
                     <input type="text" class="form-control" id="national1" name="national" required minlength="2" maxlength="20">
                  </div>
                  <div class="form-group">
                     <label class="col-form-label">Vị trí:</label>
                     <input type="text" class="form-control" id="position1" name="position" required minlength="2" maxlength="20">
                  </div>
                  <div class="form-group">
                     <label class="col-form-label">Lương:</label>
                     <input type="number" class="form-control" id="salary1" name="salary" required min="1" max="1000">
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                <button  class="btn btn-primary" id="btnEdit" >Sửa</button>
              </div>
            </div>
          </div>
        </div>
        </form>
  </div>



    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->

<script
  src="https://code.jquery.com/jquery-2.2.4.min.js"
  integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
  crossorigin="anonymous">
</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="/static/bootstrap/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="/static/js/script.js"></script>
    <script type="text/javascript">
    Ext.onReady(function(){
        Ext.QuickTips.init();

        // sample static data for the store
//        var myData = [];
      // create the data store
        var store = new Ext.data.JsonStore({
            fields: [
                {name: 'id'},
                {name: 'name', type: 'string'},
                {name: 'age', type:'int'},
                {name: 'national', type: 'string'},
                {name: 'position', type: 'string'},
                {name: 'salary', type: 'int'}
            ]
        });
         // create the Grid
        var grid = new Ext.grid.GridPanel({
            store: store,
            columns:[
                {
                    header: 'ID',
                    width: 140,
                    sortable: true,
                    dataIndex: 'id'
                },
                {
                   header: 'Tên cầu thủ',
                    width: 140,
                    sortable: true,
                    dataIndex:'name'
                },
                {
                    header: 'Tuổi',
                    width: 85,
                    sortable: true,
                    dataIndex: 'age'
                },
                {
                    header: 'Quốc tịch',
                    width: 85,
                    sortable: true,
                    dataIndex:'national'
                },
                {
                   header: 'Vị trí',
                    width: 85,
                    sortable: true,
                    dataIndex:'position'
                },
                {
                   header: 'Lương',
                    width: 85,
                    sortable: true,
                    dataIndex:'salary'
                },
                {
                    xtype: 'actioncolumn',
                    width: 85,
                    items: [
                        {
                            icon: '../static/img/btn_edit.png',
                            iconCls: 'x-action-edit',
                            id: 'btn-edit',
                            handler: function(grid, rowIndex, colIndex) {
                            // alert("Hello! I am an alert box!!");
                            var record = store.getAt(rowIndex);
                            var id = record.get('id');
                            var name = record.get('name');
                            var age = record.get('age');
                            var national = record.get('national');
                            var position = record.get('position');
                            var salary = record.get('salary');

                            var simple = new Ext.FormPanel({
                                labelWidth: 75,  // label settings here cascade unless overridden-->
                                url: 'save-form.php',
                                frame: true,
                                title: 'Sửa cầu thủ',
                                bodyStyle: 'padding: 5px 5px 0',
                                width: 400,
                                defaults: {width: 230},
                                defaultType : 'textfield',

                                items: [{
                                fieldLabel: 'ID',
                                name: 'id',
                                id: 'id',
                                value: id
                                },{
                                fieldLabel: 'Tên',
                                name: 'name',
                                id: 'name',
                                value: name,
                                allowBlank: false
                                }, {
                                fieldLabel: 'Tuổi',
                                 id: 'age',
                                 name: 'age',
                                 value: age
                                },{
                                fieldLabel: 'Quốc tịch',
                                 id: 'national',
                                 name: 'national',
                                 value: national
                                },{
                                fieldLabel: 'Vị trí',
                                 id: 'position',
                                 name: 'position',
                                 value: position
                                },{
                                fieldLabel: 'Lương',
                                 id: 'salary',
                                 name: 'salary',
                                 value: salary
                                }],
                                buttons: [{
                                text: 'Đóng',
                                handler: function(){
                                    win.hide();
                                    }
                                },{
                                text: 'Sửa',
                                id: 'btn-edit',
                                handler:function() {
                                   // var id =  $('.id').getValue();
                                    var id = Ext.getCmp('id').getValue();
                                    console.log(id);
                                    var name = Ext.getCmp('name').getValue();
                                     console.log(name);
                                    var age = parseInt(Ext.getCmp('age').getValue(), 10);
                                     console.log(age);
                                    var national = Ext.getCmp('national').getValue();
                                     console.log(national);
                                    var position = parseInt(Ext.getCmp('position').getValue());
                                     console.log(position);
                                    var salary = parseInt(Ext.getCmp('salary').getValue());
                                     console.log(salary);
                                    $.ajax({
                                    url: '/edit',
                                    method: 'POST',
                                    data: {id: id, name: name, age: age, national: national, position: position, salary: salary},
                                    success: function(data) {
                                    }
                                    });
//                                    grid.getView().refresh()
//                                    loadPage(1, 10);
                                    win.close();
                                    grid.getView().refresh();
//                                    store.loadData();
                                }
                                }]
                            });
                            var win = new Ext.Window({
                                items: [simple]
                            });
                            win.show();
                        }
                        },
                        {
                            icon: '../static/img/delete.png',
                            iconCls: 'x-action-delete'
                        }
                    ]
                }
            ],
            stripeRows: true,
//            autoExpandColumn: 'players',
            height: 350,
            width: 900,
            title: 'Thông tin cầu thủ',
            // config options for stateful behavior
            stateful: true,
            stateId: 'grid',

            bbar :new Ext.PagingToolbar ({
                pageSize: 10,
                store: store,
                displayInfo: true
            })
        });

        grid.render('datatable');

        function loadPage(current_page, page_size) {
            var url = '/getlist?page='+current_page+'&page_size='+page_size;
            $.ajax({
            url: url,
            method: "GET",
            data: {page: current_page, page_size: page_size},
            success: function(data) {
                console.log(data);
                var res = JSON.parse(data);
                console.log(res.players);
                store.loadData(res.players);
                }
            });
        }
        // manually load local data
//        store.loadData(myData);
        loadPage(1, 10);

    });
    </script>
  <style>

    .table td, .table th {
    padding: 0;
    border-top: none;
  }

  .x-action-edit {
      width: 15px;
      justify-content: center;
      padding-left: 23px;
  }

  .x-action-delete {
      width: 15px;
      justify-content: center;
      padding-left: 10px;
  }
    *, ::after, ::before {
    box-sizing: unset;
    }
  </style>
  </body>
</html>
